# Nav2 参数调优文件
# 修改后重启仿真生效，或使用动态参数更新

# ============================================================
# 速度限制调优 (提高速度)
# ============================================================
controller_server:
  ros__parameters:
    # --- 速度限制 ---
    FollowPath:
      # 前进速度 (m/s) - 提高这些值可以加快机器人
      min_vel_x: 0.0           # 最小前进速度
      max_vel_x: 1.5           # 最大前进速度 (原: 1.0)
      max_speed_xy: 1.5        # 最大线速度 (原: 1.0)
      
      # 旋转速度 (rad/s)
      min_speed_theta: 0.0     # 最小旋转速度
      max_vel_theta: 1.5       # 最大旋转速度 (原: 1.0)
      
      # --- 加速度限制 ---
      acc_lim_x: 3.0           # 前进加速度 (原: 2.5)
      decel_lim_x: -3.0        # 前进减速度 (原: -2.5)
      acc_lim_theta: 4.0       # 旋转加速度 (原: 3.2)
      decel_lim_theta: -4.0    # 旋转减速度 (原: -3.2)
      
      # --- 轨迹仿真 (影响平滑性) ---
      sim_time: 2.0            # 轨迹仿真时间 (原: 1.7)，越大越平滑但计算量更大
      vx_samples: 25           # 速度采样数 (原: 20)
      vtheta_samples: 25       # 角速度采样数 (原: 20)
      
      # --- 路径跟随评估权重 ---
      PathAlign.scale: 32.0    # 路径对齐权重
      PathDist.scale: 32.0     # 路径距离权重
      GoalAlign.scale: 24.0    # 目标对齐权重
      GoalDist.scale: 24.0     # 目标距离权重
      BaseObstacle.scale: 0.02 # 障碍物权重 (越小越激进)
      
    # --- 目标检查 ---
    general_goal_checker:
      xy_goal_tolerance: 0.20  # 位置容差 (原: 0.25)，更小=更精确
      yaw_goal_tolerance: 0.20 # 朝向容差 (原: 0.25)

# ============================================================
# 障碍物膨胀调优 (安全性 vs 通过性)
# ============================================================
global_costmap:
  global_costmap:
    ros__parameters:
      robot_radius: 0.3      # 机器人实际半径
      
      inflation_layer:
        # inflation_radius: 膨胀半径
        #   - 增大: 更安全，但狭窄通道可能无法通过
        #   - 减小: 可通过更窄的通道，但更危险
        inflation_radius: 0.50  # (原: 0.55)
        
        # cost_scaling_factor: 代价衰减因子
        #   - 增大: 代价快速衰减，机器人更靠近障碍物
        #   - 减小: 代价缓慢衰减，机器人远离障碍物
        cost_scaling_factor: 4.0  # (原: 3.0)

local_costmap:
  local_costmap:
    ros__parameters:
      robot_radius: 0.3
      
      # 局部窗口大小 (影响反应距离)
      width: 4                 # (原: 3)
      height: 4                # (原: 3)
      
      inflation_layer:
        inflation_radius: 0.45  # 局部可以更小一点 (原: 0.55)
        cost_scaling_factor: 4.0

# ============================================================
# 规划器调优
# ============================================================
planner_server:
  ros__parameters:
    GridBased:
      tolerance: 0.3           # 目标容差 (原: 0.5)
      use_astar: true          # 使用 A* 算法 (原: false)，更快但可能不是最优

# ============================================================
# 速度平滑器 (可选)
# ============================================================
velocity_smoother:
  ros__parameters:
    smoothing_frequency: 20.0
    scale_velocities: false
    feedback: "OPEN_LOOP"
    max_velocity: [1.5, 0.0, 1.5]      # [x, y, theta]
    min_velocity: [-1.5, 0.0, -1.5]
    max_accel: [3.0, 0.0, 4.0]
    max_decel: [-3.0, 0.0, -4.0]
    odom_topic: "/odom"
    odom_duration: 0.1
